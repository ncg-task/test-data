title
Look at Boundary : A Boundary - Aware Face Alignment Algorithm
abstract
We present a novel boundary - aware face alignment algorithm by utilising boundary lines as the geometric structure of a human face to help facial landmark localisation .
Unlike the conventional heatmap based method and regression based method , our approach derives face landmarks from boundary lines which remove the ambiguities in the landmark definition .
Three questions are explored and answered by this work :
1 . Why using boundary ?
2 . How to use boundary ?
3 . What is the relationship between boundary estimation and landmarks localisation ?
Our boundaryaware face alignment algorithm achieves 3.49 % mean error on 300 - W Fullset , which outperforms state - of - the - art methods by a large margin .
Our method can also easily integrate information from other datasets .
By utilising boundary information of 300 - W dataset , our method achieves 3.92 % mean error with 0.39 % failure rate on COFW dataset , and 1.25 % mean error on AFLW - Full dataset .
Moreover , we propose anew dataset WFLW to unify training and testing across different factors , including poses , expressions , illuminations , makeups , occlusions , and blurriness .
Dataset and model will be publicly available at https://wywu.github.io/projects/LAB/LAB.html
Introduction
Face alignment , which refers to facial landmark detection in this work , serves as a key step for many face applications , e.g. , face recognition , face verification and face frontalisation .
The objective of this paper is to devise an effective face alignment algorithm to handle faces with unconstrained pose variation and occlusion across multiple datasets and annotation protocols . *
This work was done during an internship at SenseTime Research .
datasets with different number of landmarks .
The second column illustrates the universally defined facial boundaries estimated by our methods .
With the help of boundary information , our approach achieves high accuracy localisation results across multiple datasets and annotation protocols , as shown in the third column .
Different to face detection and recognition , face alignment identifies geometry structure of human face which can be viewed as modeling highly structured output .
Each facial landmark is strongly associated with a well - defined facial boundary , e.g. , eyelid and nose bridge .
However , compared to boundaries , facial landmarks are not so well - defined .
Facial landmarks other than corners can hardly remain the same semantical locations with large pose variation and occlusion .
Besides , different annotation schemes of existing datasets lead to a different number of landmarks ( 19/29/68/194 points ) and annotation scheme of future face alignment datasets can hardly be determined .
We believe the reasoning of a unique facial structure is the key to localise facial landmarks since human face does not include ambiguities .
To this end , we use well - defined facial boundaries to represent the geometric structure of the human face .
It is easier to identify facial boundaries comparing to facial landmarks under large pose and occlusion .
In this work , we represent facial structure using 13 boundary lines .
Each facial boundary line can be interpolated from a sufficient number of facial landmarks across multiple datasets , which will not suffer from inconsistency of the annotation schemes .
Our boundary - aware face alignment algorithm contains two stages .
We first estimate facial boundary heatmaps and then regress landmarks with the help of boundary heatmaps .
As noticed in , facial landmarks of different annotation schemes can be derived from boundary heatmaps with the same definition .
To explore the relationship between facial boundaries and landmarks , we introduce adversarial learning ideas by using a landmark - based boundary effectiveness discriminator .
Experiments have shown that the better quality estimated boundaries have , the more accurate landmarks will be .
The boundary heatmap estimator , landmark regressor , and boundary effectiveness discriminator can be jointly learned in an end - to - end manner .
We used stacked hourglass structure to estimate facial boundary heatmap and model the structure between facial boundaries through message passing to increase its robustness to occlusion .
After generating facial boundary heatmaps , the next step is deriving facial landmarks using boundaries .
The boundary heatmaps serve as structure cue to guide feature learning for the landmark regressor .
We observe that a model guided by ground truth boundary heatmaps can achieve 76. 26 % AUC on 300 W test while the state - of - the - art method can only achieve 54.85 % .
This suggests the richness of information contained in boundary heatmaps .
To fully utilise the structure information , we apply boundary heatmaps at multiple stages in the landmark regression network .
Our experiment shows that the more stages boundary heatmaps are used in feature learning , the better landmark prediction results we will get .
We evaluate the proposed method on three popular face alignment benchmarks including 300W , COFW , and AFLW .
Our approach significantly outperforms previous state - of - the - art methods by a large margin .
3.49 % mean error on 300 - W Fullset , 3.92 % mean error with 0.39 % failure rate on COFW and 1.25 % mean error on AFLW - Full dataset respectively .
To unify the evaluation , we propose anew large dataset named Wider Facial Landmarks in - the - wild ( WFLW ) which contain 10 , 000 images .
Our new dataset introduces large pose , expression , and occlusion variance .
Each image is annotated with 98 landmarks and 6 attributes .
Comprehensive ablation study demonstrates the effectiveness of each component .
Related Work
In the literature of face alignment , besides classic methods ( ASMs , AAMs , CLMs and Cascaded Regression Models ) , recently , state - of - the - art performance has been achieved with Deep Convolutional Neural Networks ( DC - NNs ) .
These methods mainly fall into two categories , i.e. , coordinate regression model and heatmap regression model .
Coordinate regression models directly learn the mapping from the input image to the landmark coordinates vector .
Zhang et al. frames the problem as a multi-task learning problem , learns landmark coordinates and predicts facial attributes at the same time .
MDM is the first end - to - end recurrent convolutional system for face alignment from coarse to fine .
TSR splits face into several parts to ease the parts variations and regresses the coordinates of different parts respectively .
Even though coordinate regression models have the advantage of explicit inference of landmark coordinates without any post-processing .
Nevertheless , they are not performing as well as heatmap regression models .
Heatmap regression models , which generate likelihood heatmaps for each landmark respectively , have recently achieved state - of - the - art performance in face alignment .
CALE is a two - stage convolutional aggregation model to aggregate score maps predicted by detection stage along with early CNN features for final heatmap regression .
Yang et al .
uses a two parts network , i.e. , a supervised transformation to normalise faces and a stacked hourglass network to get prediction heatmaps .
Most recently , JMFA achieves state - of - the - art accuracy by leveraging stacked hourglass network for multi-view face alignment and demonstrates better than the best three entries of the last Menpo Challenge .
Since boundary detection was set as one of the most fundamental problems in computer vision and there have emerged a large number of materials .
It has been proved efficient in vision tasks as segmentation and object detection .
In face alignment , boundary information demonstrates especial importance because almost all of the landmarks are defined lying on the facial boundaries .
However , as far as we know , in face alignment task , no work before has investigated the use of boundary information from an explicit perspective .
The recent advance inhuman pose estimation partially inspires our method of boundary heatmaps estimation .
Stacked hourglass network achieves compelling accuracy with a bottom - up , top - down design which endows the network with capabilities of obtaining multi-scale information .
Message passing has shown great power in structure modeling of human joints .
Recently , adversarial learning ] is adopted to further improve the accuracy of estimated human pose under heavy occlusion .
network is used to estimate boundary heatmaps .
Message passing layers are introduced to handle occlusion .
( b ) Boundary - aware landmarks regressor is used to generate the final prediction of landmarks .
Boundary heatmap fusion scheme is introduced to incorporate boundary information into the feature learning of regressor .
( c ) Boundary effectiveness discriminator , which distinguishes " real " boundary heatmaps from " fake " , is used to further improve the quality of the estimated boundary heatmaps .
Boundary - Aware Face Alignment
As mentioned in the introduction , landmarks have difficulty in presenting accurate and universal geometric structure of face images .
We propose facial boundary as geometric structure representation and help landmarks regression problem in the end .
Boundaries are detailed and welldefined structure descriptions , which are consistent across head poses and datasets .
They are also closely related to landmarks since most of the landmarks are located along boundary lines .
Other choices are also available for geometric structure representations .
Recent works ] has adopted facial parts to aid face alignment tasks .
However , facial parts are too coarse thus not as powerful as boundary lines .
Another choice would be face parsing results .
Face parsing leads to disjoint facial components which needs the boundaries of each component form a closed loop .
However , some facial organs such as nose are naturally blended into the whole face thus are inaccurate to be defined as separate parts .
On the contrary , boundary lines are not necessary to form a closed loop , which is more flexible in representing geometric structure .
Experiments in Sec 4.2 have shown that boundary lines are the best choice to aid landmark coordinates regression .
The detailed configuration of our proposed Boundary - Aware Face Alignment framework is illustrated in .
It is composed of three closely related components :
Boundary - Aware Landmark Regressor , Boundary Heatmap Estimator and Landmark - Based Boundary Effectiveness Discriminator .
Boundary - Aware Landmark Regressor incorporates boundary information in a multi-stage manner to predict landmark coordinates .
Boundary Heatmap Estimator produces boundary heatmaps as face geometric structure .
Since boundary information is used heavily , the quality of boundary heatmaps is crucial for final landmark regression .
We introduce adversarial learning idea by proposing Landmark - Based Boundary Effectiveness Dis-criminator , which is paired with the Boundary Heatmap Estimator .
This discriminator can further improve the quality of boundary heatmaps and lead to better landmark coordinates prediction .
Boundary - aware landmarks regressor
In order to fuse boundary line into feature learning , we transform landmarks to boundary heatmaps to aid the learning of feature .
The responses of each pixel in boundary heatmap are decided by its distance to the corresponding boundary line .
As shown in , the details of boundary heatmap are defined as follows .
Given a face image I , denote its ground truth annotation by L landmarks as S = {s l } L l=1 .
K subsets
Si ?
S are defined to represent landmarks belongs to K boundaries respectively , such as upper left eyelid and nose bridge .
For each boundary ,
Si is interpolated to get a dense boundary line .
Then a binary boundary map Bi , the same size as I , is formed by setting only points on the boundary line to be 1 , others
0 . Finally , a distance transform is performed based on each Bi to get distance map Di .
We use a gaussian expression with standard deviation ? to transform the distance map to ground - truth boundary heatmap M i .
3 ?
is used to threshold
Di to make boundary heatmaps focus more on boundary areas .
In practice , the length of the ground - truth boundary heatmap side is set to a quarter of the size of I for computation efficiency .
In order to fully utilise the rich information contained in boundary heatmaps , we propose a multi-stage boundary heatmap fusion scheme .
As illustrated in , A fourstage res - 18 network is adopted as our baseline network .
Boundary heatmap fusion is conducted at the input and every stage of the network .
Comprehensive results in Sec. have shown that the more fusion we conducted to the baseline network , the better performance we can get .
Input image fusion .
To fuse boundary heatmap M with input image I , the fused input H is defined as :
where ?
represents the element - wise dot product operation and ?
represents channel - wise concatenation .
The above design makes fused input focus only on detailed texture around boundaries .
Thus most background and texture - less face regions are ignored which greatly enhance the effectiveness of input .
The original input is also concatenated to the fused ones to keep other valuable information in the original image .
Feature map fusion .
Similar to above , to fuse boundary heatmap M with feature map F , the fused feature map H is defined as :
Since the number of channels of M equals to the number of pre-defined boundaries , which is constant .
A transform function T is necessary to convert M to have the same channels with F .
We choose hourglass structure subnet as T to keep feature map size .
Down - sampling and upsampling are performed symmetrically .
Skip connections
Input Face Image Baseline Hourglass Baseline + Message Passing
Baseline + Message Passing + Adversarial Learning Since boundary heatmaps are used heavily in landmarks coordinates regression .
The quality of boundary heatmaps is essential to the prediction accuracy .
By fusing ground truth boundary heatmaps , our method can achieve 76. 26 % AUC on 300 - W test , comparing to the state - of - art result 54.85 % .
Based on this experiment , in the following sections , several methods will be introduced to improve the quality of generated boundary heatmaps .
Experiment in ablation study also shows the consistent performance gain with better heatmap quality .
Boundary heatmap estimator
Following previous work in face alignment and human pose , we use stacked hourglass as the baseline of boundary heatmap estimator .
Mean square error ( MSE ) between generated and groundtruth boundary heatmaps is optimized .
However , as demonstrated in , when heavy occlusions happen , the generated heatmaps always suffer from the noisy and multi-mode response , which has also been mentioned in .
In order to relieve the problem caused by occlusion , we introduce message passing layers to pass information between boundaries .
This process is visualised in .
During occlusion , visible boundaries can provide help to occluded ones according to face structure .
Intra - level message passing is used at the end of each stack to pass information between different boundary heatmaps .
Thus , information can be passed from visible boundaries to occluded ones .
Moreover , since different stacks of hourglass focus on different aspects of face information .
Inter - level message passing is adopted to pass message from lower stacks to the higher stacks to keep the quality of boundary heatmaps when stacking more hourglass subnets .
We implemented message passing following .
In this implementation , the feature map at the end of each stack needs be divided into K branches , where K is the number
Intra - level Message Passing
Inter - level Message Passing :
An illustration of message pass scheme .
A bi-direction tree structure is used for intra-level message passing .
Inter - level message is passed between adjacent stacks from lower to higher .
of boundaries , each represents a type of boundary feature map .
This requirement demonstrates the advantage of our boundary heatmaps compared with landmark heatmaps for the small and constant number K of them .
Thus , the computational and parameter cost of message passing layers within boundaries is small while it is not practical for message passing within 68 or even 194 landmarks .
Boundary effectiveness discriminator
In structured boundary heatmap estimator , mean squared error ( MSE ) is used as the loss function .
However , minimizing MSE sometimes makes the prediction look blurry and implausible .
This regression - to - the - mean problem is a well - known fact in the literature of super- resolution .
It damages the learning of regression network when bad boundary heatmaps are generated .
However , in our framework , the hard - to - define term " quality " of heatmaps has a very clear evaluation metric .
If helping to produce accurate landmark coordinates , the boundary heatmap has a good quality .
According to this , we propose a landmark based boundary effectiveness discriminator to decide the effectiveness of the generated boundary heatmaps .
For a generated boundary heatmap M ( all index i such as M i is omitted for the simplicity of notation ) , denote its corresponding generated landmark coordinates set as ? , the ground - truth distance matric map as Dist .
The ground truth d fake of discriminator D that determines whether the generated boundary heatmap is fake can be defined as
Where ?
is the distance threshold to ground truth boundary and ?
is the probability threshold .
This discriminator predicts whether most generated corresponding landmarks would be close to the ground truth boundary .
Following , we introduce the idea of adversarial learning by pairing the boundary effectiveness discriminator D and the boundary heatmaps estimator G.
The loss of D can be expressed as :
( 5 ) Where M is the ground truth boundary heatmap .
The discriminator learns to predict ground truth boundary heatmap as one while predict generated boundary heatmap according to d fake .
With effectiveness discriminator , the adversarial loss can be expressed as :
Thus , the estimator is optimised to fool D by giving more plausible and high - confidence maps that will benefit the learning of regression network .
The following pseudo - code shows the training process of the whole methods .
Forward D byd fake = D (M ) and optimize D by minimizing the second term of L D defined in Eq.5 ;
5 :
Forward R by ? = R ( I , M ) and optimize R by minimizing ? ? S 2 2 ; 6 : end while
Cross - Dataset Face Alignment
Recently , together with impressive progress of algorithms for face alignment , various benchmarks have also been released , e.g. , LFPW , AFLW and 300 - W .
However , because of the gap between annotation schemes , these datasets can hardly be jointly used .
Models trained on one specific dataset perform poorly on recent in - the - wild test sets .
However , introduction of an annotation transfer component will bring new problems .
From anew perspective , we take facial boundaries as an all - purpose middle - level face geometry representation .
Facial boundaries naturally unify different landmark definitions with enough landmarks .
And it can also be applied to help training landmarks regressor with any specific landmarks definition .
The cross - dataset capacity is an important by - product of our methods .
It s effectiveness is evaluated in Sec. 4.1 .
Experiments
Datesets .
We conduct evaluation on four challenging datasets including 300W , COFW , AFLW and WFLW which is annotated by ourself .
300 W dataset : 300W is currently the most widelyused benchmark dataset .
We regard all the training samples ( 3148 images ) as the training set and perform testing on ( i ) full set and ( ii ) test set .
( i ) Full set contains 689 images and is split into common subset ( 554 images ) and challenging subsets ( 135 images ) .
( ii ) Test set is the private test - set used for the 300W competition which contains 600 images .
COFW dataset consists of 1345 images for training and 507 faces for testing which are all occluded to different degrees .
Each COFW face originally has 29 manually annotated landmarks .
We also use the test set which has been re-annotated by with 68 landmarks annotation scheme to allow easy comparison to previous methods .
AFLW dataset : AFLW contains 24386 in - the - wild faces with large head pose up to 120 for yaw and 90 for pitch and roll .
We follow to adopt three settings on our experiments : ( i ) AFLW - Full : 20000 and 4386 images are used for training and testing respectively .
( ii ) AFLW - Frontal : 1314 images are selected from 4386 testing images for evaluation on frontal faces .
WFLW dataset :
In order to facilitate future research of face alignment , we introduce anew facial dataset base on WIDER Face named Wider Facial Landmarks inthe-wild ( WFLW ) , which contains 10000 faces ( 7500 for training and 2500 for testing ) with 98 fully manual annotated landmarks .
Apart from landmark annotation , out new dataset includes rich attribute annotations , i.e. , occlusion , pose , make - up , illumination , blur and expression for comprehensive analysis of existing algorithms .
Compare to previous dataset , faces in the proposed dataset introduce large variations in expression , pose and occlusion .
We can simply evaluate the robustness of pose , occlusion , and expression on proposed dataset instead of switching between multiple evaluation protocols in different datasets .
The comparison of WFLW with popular benchmarks is illustrated in the supplementary material .
Evaluation metric .
We evaluate our algorithm using standard normalised landmarks mean error and Cumulative Errors Distribution ( CED ) curve .
In addition , two further statistics i.e. the area-under - the - curve ( AUC ) and the failure rate fora maximum error of 0.1 are reported .
Because of various profile face on AFLW dataset , we follow to use face size as the normalising factor .
For other dataset , we follow MDM and to use outer - eye - corner distance as the " inter-ocular " normalising factor .
Specially , to compare with the results that reported to be normalised by " inter-pupil " ( eye-centre - distance ) distance , we report our results with both two normalising factors on and resized to 256 256 according to provided bounding boxes .
The estimator is stacked four times if not specially indicated in our experiment .
For ablation study , the estimator is stacked two times due to the consideration of time and computation cost .
All our models are trained with Caffe [ 24 ] on 4 Titan X GPUs .
Note that all testing images are cropped and resized according to provided bounding boxes without any spatial transformation for fair comparison with other methods .
For the limited space of paper , we report all of the training details and experiment settings in our supplementary material .
Comparison with existing approaches 4.1.1 Evaluation on 300W
We compare our approach against the state - of - the - art methods on 300W Fullset .
The results are shown in error on the Challenging subset which reflects the effectiveness of handling large head rotation and exaggerated expressions .
Apart from 300W Fullset , we also show our results on 300W Testset in .
Our method performs best among all of the state - of - the - art methods .
To verify the effectiveness and potential of boundary maps , we use ground truth boundary in the proposed method and report results named " LAB + oracle " which significantly outperform all the methods .
The results demonstrate the effectiveness of boundary information and show great potential performance gain if the boundary information can be well captured .
Evaluation on WFLW
For comprehensively evaluating the robustness of our method , we report mean error , failure rate and AUC on the Testset and six typical subsets of WFLW on 3 .
These six subsets were split from Testset by the provided attribute annotations .
Though reasonable performance is obtained , there is illustrated to be still a lot of room for improvement for the extreme diversity of samples on WFLW , e.g. , large pose , exaggerated expressions and heavy occlusion .
Cross - dataset evaluation on COFW and AFLW
COFW - 68 is produced by re-annotating COFW dataset with 68 landmarks annotation scheme to perform cross - dataset experiments by .
shows the CED curves of our method against state - of - the - art methods on the COFW - 68 dataset .
Our model outperforms previous results with a large margin .
We achieve 4.62 % mean error with 2.17 % failure rate .
The failure rate is significantly reduced by 3.75 % , which indicates the robustness of our method to handle occlusions .
In order to verify the capacity of handling cross - dataset face alignment of our method , we use boundary heatmaps estimator trained on 300W Fullset which has no overlap with COFW and AFLW dataset and compare the performance with and without using boundary information fusion ( " LAB w/o boundary " ) .
The results are reported in .
The performance of previous methods without using 300 - W datasets is also attached as a reference .
There is a clear boost between our method without and with using boundary information .
Thanks to the generalization of facial boundaries , the estimator learned on 300 W can be conveniently used to supply boundary information for coordinate regression on COFW - 29 and AFLW dataset , even though these datasets have different annotation protocols .
Moreover , our method uses boundary information achieves 29 % , 32 % and 29 % relative performance improve- ment over the baseline method ( " LAB without boundary " ) on COFW - 29 , AFLW - Full and AFLW - Frontal respectively .
Since COFW covers different level of occlusion and AFLW has significant view changes and challenging shape variations , the results emphasise the robustness brought by boundary information to occlusion , pose and shape variations .
More qualitative results are demonstrated in our supplementary material .
Ablation study
Our framework consists of several pivotal components , i.e. , boundary information fusion , message passing and adversarial learning .
In this section , we validate their effectiveness within our framework on the 300W Challenging Set and WFLW Dataset .
Based on the baseline res - 18 network ( BL ) , we analyse each proposed component , i.e. , with the baseline hourglass boundary estimator ( " HBL " ) , message passing ( " MP " ) , and adversarial learning ( " AL " ) , by comparing their mean error and failure rate .
The overall results are shown in .
Boundary information is chosen as geometric structure representation in our work .
We verify the potential of other structure information as well , i.e. , facial parts gaussian ( " FPG " ) and face parsing results ( " FP " ) .
We report the landmarks accuracy with oracle results in using different structure information .
It can be observed easily that boundary map ( " BM " ) is the most effective one .
Boundary information fusion is one of the key steps in our algorithm .
We can fuse boundary information at different levels for the regression network .
As indicated in , our final model that fuses boundary information in all four levels improves mean error from 7.12 % to 6.13 % .
To evaluate the relationship between the quantity of boundary information fusion and the final prediction accuracy , we vary the number of fusion levels from 1 to 4 and report the mean error results in .
It can be observed that performance is improved consistently by fusing boundary heatmaps at more levels .
Method
BL BL+ FPG BL + FP BL + BM Mean Error 7 . 5.25 4.16 3.28 To verify the effectiveness of the fusion scheme shown in , we report the results of mean error on several settings in , i.e. , the baseline res - 18 network ( " BL " ) , hourglass module without boundary feature ( " HG / B " ) , hourglass module with boundary feature ( " HG " ) and consecutive convolutional layers with boundary feature ( " CL " ) .
The comparison between " BL + HG " and " BL + HG/ B " indicates the effectiveness of boundary information fusion rather than network structure changes .
The comparison between " BL + HG " and " BL + CL " indicates the effectiveness of the using hourglass structure design .
Message passing plays a vital role for heatmap quality improvement when severe occlusions happen .
As illustrated in on Occlusion Subset of WFLW , message passing , which combines information from visible boundaries and occluded ones , reduce the mean error over 11 % relatively .
Adversarial learning further improves the quality and effectiveness of boundary heatmaps .
As illustrated in , heatmaps can be observed to be more focused and salience when adversarial loss is added .
To verify the effectiveness of our landmark based boundary effectiveness discriminator , a baseline method using traditionally defined discriminator is tested on 300W Challenging Set .
The failure rate is reduced from 5.19 % to 3.70 % .
Relationship between boundary estimator and landmarks regressor is evaluated by analyzing the quality of estimated heatmap and final prediction accuracy .
We report the MSE of estimated heatmaps and corresponding landmarks accuracy in .
We observe that with message passing ( " HBL + MP " ) and adversarial learning ( " HBL + AL " ) , the errors of estimated heatmaps are reduced together with landmarks accuracy .
Conculsion
Unconstrained face alignment is an emerging topic .
In this paper , we present a novel use of facial boundary to derive facial landmarks .
We believe the reasoning of a unique facial structure is the key to localise facial landmarks , since human face does not include ambiguities .
By estimating facial boundary , our method is capable of handling arbitrary head poses as well as large shape , appearance , and occlusion variations .
Our experiment shows the great potential of modeling facial boundary .
The runtime of our algorithm is 60 ms on TITAN X GPU .
