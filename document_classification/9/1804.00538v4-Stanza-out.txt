title
Investigating Capsule Networks with Dynamic Routing for Text Classification
abstract
In this study , we explore capsule networks with dynamic routing for text classification .
We propose three strategies to stabilize the dynamic routing process to alleviate the disturbance of some noise capsules which may contain " background " information or have not been successfully trained .
A series of experiments are conducted with capsule networks on six text classification benchmarks .
Capsule networks achieve competitive results over the compared baseline methods on 4 out of 6 datasets , which shows the effectiveness of capsule networks for text classification .
We additionally show that capsule networks exhibit significant improvement when transfer single - label to multi-label text classification over the competitors .
To the best of our knowledge , this is the first work that capsule networks have been empirically investigated for text modeling 1 . * Corresponding author ( min.yang@siat.ac.cn )
1 Codes are publicly available at : https : //github.com/andyweizhao/capsule_text_ classification .
Introduction
Modeling articles or sentences computationally is a fundamental topic in natural language processing .
It could be as simple as a keyword / phrase matching problem , but it could also be a nontrivial problem if compositions , hierarchies , and structures of texts are considered .
For example , a news article which mentions a single phrase " US election " maybe categorized into the political news with high probability .
But it could be very difficult for a computer to predict which presidential candidate is favored by its author , or whether the author 's view in the article is more liberal or more conservative .
Earlier efforts in modeling texts have achieved limited success on text categorization using a simple bag - of - words classifier , implying understanding the meaning of the individual word or n-gram is a necessary step towards more sophisticated models .
It is therefore not a surprise that distributed representations of words , a.k.a. word embeddings , have received great attention from NLP community addressing the question " what " to be modeled at the basic level .
In order to model higher level concepts and facts in texts , an NLP researcher has to think cautiously the so - called " what " question : what is actually modeled beyond word meanings .
A common approach to the question is to treat the texts as sequences and focus on their spatial patterns , whose representatives include convolutional neural networks ( CNNs ) and long shortterm memory networks ( LSTMs ) .
Another common approach is to completely ignore the order of words but focus on their compositions as a collection , whose representatives include probabilistic topic modeling and Earth Mover 's Distance based modeling .
Those two approaches , albeit quite different from the computational perspective , actually follow a common measure to be diagnosed regarding their answers to the " what " question .
In neural network approaches , spatial patterns aggregated at lower levels contribute to representing higher level concepts .
Here , they form a recursive process to articulate what to be modeled .
For example , CNN builds convolutional feature detectors to extract local patterns from a window of vector sequences and uses max - pooling to select the most prominent ones .
It then hierarchically builds such pattern extraction pipelines at multiple levels .
Being a spatially sensitive model , CNN pays a price for the inefficiency of replicating feature detectors on a grid .
As argued in , one has to choose between replicating detectors whose size grows exponentially with the number of dimensions , or increasing the volume of the labeled training set in a similar exponential way .
On the other hand , methods thatare spatially insensitive are perfectly efficient at the inference time regardless of any order of words or local patterns .
However , they are unavoidably more restricted to encode rich structures presented in a sequence .
Improving the efficiency to encode spatial patterns while keeping the flexibility of their representation capability is thus a central issue .
A recent method called capsule network introduced by possesses this attractive potential to address the aforementioned issue .
They introduce an iterative routing process to decide the credit attribution between nodes from lower and higher layers .
A metaphor ( also as an argument ) they made is that human visual system intelligently assigns parts to wholes at the inference time without hard - coding patterns to be perspective relevant .
As an outcome , their model could encode the intrinsic spatial relationship between apart and a whole constituting viewpoint invariant knowledge that automatically generalizes to novel viewpoints .
In our work , we follow a similar spirit to use this technique in modeling texts .
Three strategies are proposed to stabilize the dynamic routing process to alleviate the disturbance of some noise capsules which may contain " background " information such as stop words and the words thatare unrelated to specific categories .
We conduct a series of experiments with capsule networks on top of the pre-trained word vectors for six text classification benchmarks .
More importantly , we show that capsule networks achieves significant improvement when transferring singlelabel to multi-label text classifications over strong baseline methods .
Our Model
Our capsule network , depicted in , is a variant of the capsule networks proposed in .
It consists of four layers : ngram convolutional layer , primary capsule layer , convolutional capsule layer , and fully connected capsule layer .
In addition , we explore two capsule frameworks to integrate these four components in different ways .
In the rest of this section , we elaborate the key components in detail .
N - gram Convolutional Layer
This layer is a standard convolutional layer which extracts n-gram features at different positions of a sentence through various convolutional filters .
Suppose x ?
R LV denotes the input sentence representation where L is the length of the sentence and V is the embedding size of words .
Let xi ?
RV be the V - dimensional word vector corresponding to the i - th word in the sentence .
Let W a ? R K 1
V be the filter for the convolution operation , where K 1 is the N - gram size while sliding over a sentence for the purpose of detecting features at different positions .
A filter W a convolves with the word - window x i:i+K 1 ? 1 at each possible position ( with stride of 1 ) to produce a column feature map ma ?
R L?K 1 + 1 , each element ma i ?
R of the feature map is produced by
where is element - wise multiplication , b 0 is a bias term , and f is a nonlinear activate function ( i.e. , ReLU ) .
We have described the process by which one feature is extracted from one filter .
Hence , for a = 1 , . . . , B , totally B filters with the same N - gram size , one can generate B feature maps which can be rearranged as
Primary Capsule Layer
This is the first capsule layer in which the capsules replace the scalar - output feature detectors of CNNs with vector- output capsules to preserve the instantiated parameters such as the local order of words and semantic representations of words .
Suppose pi ?
Rd denotes the instantiated parameters of a capsule , where d is the dimension of the capsule .
Let W b ? R
Bd be the filter shared in different sliding windows .
For each matrix multiplication , we have a window sliding over each Ngram vector denoted as M i ?
R B , then the corresponding N - gram phrases in the form of capsule are produced with
ConvCaps Capsule
Probability column - list of capsules p ? R ( L?K 1 + 1 ) d , each capsule pi ?
Rd in the column - list is computed as
where g is nonlinear squash function through the entire vector , b 1 is the capsule bias term .
For all C filters , the generated capsule feature maps can be rearranged as
where totally ( L ? K 1 + 1 ) C d-dimensional vectors are collected as capsules in P .
Child - Parent Relationships
As argued in , capsule network tries to address the representational limitation and exponential inefficiencies of convolutions with transformation matrices .
It allows the networks to automatically learn child - parent ( or partwhole ) relationships .
In text classification tasks , different sentences with the same category are supposed to have the similar topic but with different viewpoints .
In this paper , we explore two different types of transformation matrices to generate prediction vector ( vote ) j|i ?
Rd from it s child capsule i to the parent capsule j.
The first one shares weights W t 1 ?
RN dd across child capsules in the layer below , where N is the number of parent capsules in the layer above .
Formally , each corresponding vote can be computed by :
where u i is a child - capsule in the layer below and b j|i is the capsule bias term .
In the second design , we replace the shared weight matrix W t 1 j with non-shared weight matrix W t 2 i , j , where the weight matrices W t 2 ?
R HN dd and H is the number of child capsules in the layer below .
Dynamic Routing
The basic idea of dynamic routing is to construct a non-linear map in an iterative manner ensuring that the output of each capsule gets sent to an appropriate parent in the subsequent layer :
For each potential parent , the capsule network can increase or decrease the connection strength by dynamic routing , which is more effective than the primitive routing strategies such as max - pooling in CNN that essentially detects whether a feature is present in any position of the text , but loses spatial information about the feature .
We explore three strategies to boost the accuracy of routing process by alleviating the disturbance of some noisy capsules :
Orphan Category
Inspired by , an additional " orphan " category is added to the network , which can capture the " background " information of the text such as stop words and the words thatare unrelated to specific categories , helping the capsule network model the child - parent relationship more efficiently .
Adding " orphan " category in the text is more effective than in image since there is no single consistent " background " object in images , while the stop words are consistent in texts such as predicate " s " , " am " and pronouns " his " , " she " .
Leaky - Softmax
We explore Leaky - Softmax in the place of standard softmax while updating connection strength between the children capsules and their parents .
Despite the orphan category in the last capsule layer , we also need a light - weight method between two consecutive layers to route the noise child capsules to extra dimension without any additional parameters and computation consuming .
Coefficients Amendment
We also attempt to use the probability of existence of child capsules in the layer below to iteratively amend the connection strength as Eq.6 .
Algorithm 1 : Dynamic Routing Algorithm 1 procedure ROUTING ( j|i , j|i , r , l ) 2 Initialize the logits of coupling coefficients b j|i = 0 3 for r iterations do 4 for all capsule i in layer land capsule j in layer l + 1 :
for all capsule i in layer land capsule j in
Given each prediction vector j|i and its probability of existence j|i , where j|i = i , each iterative coupling coefficient of connection strength c j|i is updated by
where b j|i is the logits of coupling coefficients .
Each parent capsule v j in the layer above is a weighted sum over all prediction vectors j|i :
where a j is the probabilities of parent capsules , g is nonlinear squash function through the entire vector .
Once all of the parent capsules are produced , each coupling coefficient b j|i is updated by :
For simplicity of notation , the parent capsules and their probabilities in the layer above are denoted as v , a = Routing ( )
where denotes all of the child capsules in the layer below , v denotes all of the parent - capsules and their probabilities a.
Our dynamic routing algorithm is summarized in Algorithm
1 .
Convolutional Capsule Layer
In this layer , each capsule is connected only to a local region K 2 C spatially in the layer below .
Those capsules in the region multiply transformation matrices to learn child - parent relationships followed by routing by agreement to produce parent capsules in the layer above .
Suppose W c 1 ? R Ddd and W c 2 ?
R K
2 CDdd denote shared and non-shared weights , respectively , where K 2 C is the number of child capsules in a local region in the layer below , Dis the number of parent capsules which the child capsules are sent to .
When the transformation matrices are shared across the child capsules , each potential parent - capsule j|i is produced b?
where b j|i is the capsule bias term , u i is a child capsule in a local region K 2 C and W c 1 j is the j th matrix in tensor W c 1 .
Then , we use routingby - agreement to produce parent capsules feature maps totally ( L?K 1 ? K 2 + 2 ) D d-dimensional capsules in this layer .
When using the non-shared weights across the child capsules , we replace the transformation matrix W c 1 j in Eq. ( 10 ) with W c 2 j .
Fully Connected Capsule Layer
The capsules in the layer below are flattened into a list of capsules and fed into fully connected capsule layer in which capsules are multiplied by transformation matrix W d 1 ?
R Edd or W d 2 ?
R HEdd followed by routing - by - agreement to produce final capsule v j ?
Rd and its probability a j ?
R for each category .
Here , H is the number of child capsules in the layer below , E is the number of categories plus an extra orphan category .
The Architectures of Capsule Network
We explore two capsule architectures ( denoted as Capsule - A and Capsule - B ) to integrate these four
Capsule - B Capsule - A starts with an embedding layer which transforms each word in the corpus to a 300 - dimensional ( V = 300 ) word vector , followed by a 3 - gram ( K 1 = 3 ) convolutional layer with 32 filters ( B = 32 ) and astride of 1 with ReLU non-linearity .
All the other layers are capsule layers starting with a B d primary capsule layer with 32 filters ( C = 32 ) , followed by a 3 C d d ( K 2 = 3 ) convolutional capsule layer with 16 filters ( D = 16 ) and a fully connected capsule layer in sequence .
Each capsule has 16 - dimensional ( d = 16 ) instantiated parameters and their length ( norm ) can describe the probability of the existence of capsules .
The capsule layers are connected by the transformation matrices , and each connection is also multiplied by a routing coefficient that is dynamically computed by routing by agreement mechanism .
The basic structure of Capsule - B is similar to Capsule - A except that we adopt three parallel networks with filter windows ( N ) of 3 , 4 , 5 in the N - gram convolutional layer ( see ) .
The final output of the fully connected capsule layer is fed into the average pooling to produce the final results .
In this way , Capsule - B can learn more meaningful and comprehensive text representation .
3 Experimental Setup
Experimental Datasets
In order to evaluate the effectiveness of our model , we conduct a series of experiments on six bench - marks including : movie reviews ( MR ) , Stanford Sentiment Treebankan extension of MR ( SST - 2 ) , Subjectivity dataset ( Subj ) , TREC question dataset ( TREC ) , customer review ( CR ) , and AG 's news corpus .
These benchmarks cover several text classification tasks such as sentiment classification , question categorization , news categorization .
The detailed statistics are presented in
Implementation Details
In the experiments , we use 300 - dimensional word2vec vectors to initialize embedding vectors .
We conduct mini-batch with size 50 for AG 's news and size 25 for other datasets .
We use Adam optimization algorithm with 1e - 3 learning rate to train the model .
We use 3 iteration of routing for all datasets since it optimizes the loss faster and converges to a lower loss at the end .
Baseline methods
In the experiments , we evaluate and compare our model with several strong baseline methods including : LSTM / Bi - LSTM , tree - structured LSTM ( Tree - LSTM ) , LSTM regularized by linguistic knowledge ( LR - LSTM ) , CNNrand / CNN - static / CNN - non-static ( Kim , 2014 ) , very deep convolutional network ( VD - CNN ) , and character - level convolutional network ( CL - CNN ) .
Experimental Results
Quantitative Evaluation
In our experiments , the evaluation metric is classification accuracy .
We summarize the experimental results in .
From the results , we observe that the capsule networks achieve best results on 4 out of 6 benchmarks , which verifies the effectiveness of the capsule networks .
In particular , our model substantially and consistently outperforms
Ablation Study
To analyze the effect of varying different components of our capsule architecture for text classification , we also report the ablation test of the capsule - B model in terms of using different setups of the capsule network .
The experimental results are summarized in .
Generally , all three proposed dynamic routing strategies contribute to the effectiveness of Capsule - B by alleviating the disturbance of some noise capsules which may contain " background " information such as stop words and the words thatare unrelated to specific categories .
More comprehensive comparison results are demonstrated in . 4 in Supplementary Material .
Single - Label to Multi - Label Text Classification
Capsule network demonstrates promising performance in single - label text classification which as - signs a label from a predefined set to a text ( see ) .
Multi-label text classification is , however , a more challenging practical problem .
From singlelabel to multi-label ( with n category labels ) text classification , the label space is expanded from n to 2 n , thus more training is required to cover the whole label space .
For single - label texts , it is practically easy to collect and annotate the samples .
However , the burden of collection and annotation for a large scale multi-label text dataset is generally extremely high .
How deep neural networks ( e.g. , CNN and LSTM ) best cope with multi-label text classification still remains a problem since obtaining large scale of multi-label dataset is a timeconsuming and expensive process .
In this section , we investigate the capability of capsule network on multi-label text classification by using only the single - label samples as training data .
With feature property as part of the information extracted by capsules , we may generalize the model better to multi-label text classification without an over extensive amount of labeled data .
The evaluation is carried on the Reuters - 21578 dataset .
This dataset consists of 10,788 documents from the Reuters financial newswire service , where each document contains either multiple labels or a single label .
We reprocess the corpus to evaluate the capability of capsule networks of transferring from single - label to multi-label text classification .
For dev and training , we only use the single - label documents in the Reuters dev and training sets .
For testing , Reuters - Multi - label only uses the multi-label documents in testing dataset , while Reuters - Full includes all documents in test set .
The characteristics of these two datasets are described in .
Following ( Sorower , 2010 ) , we adopt Micro Averaged Precision ( Precision ) , Micro Averaged Recall ( Recall ) and Micro Averaged F1 scores ( F1 ) as the evaluation metrics for multi-label text classification .
Any of these scores are firstly computed on individual class labels and then averaged over all classes , called label - based measures .
In addition , we also measure the Exact Match Ratio ( ER ) which considers partially correct prediction as incorrect and only counts fully correct samples .
The experimental results are summarized in .
From the results , we can observe that the capsule networks have substantial and significant improvement in terms of all four evaluation metrics over the strong baseline methods on the test sets in both Reuters - Multi-label and Reuters - Full datasets .
In particular , larger improvement is achieved on Reuters - Multi - label dataset which only contains the multi-label documents in the test set .
This is within our expectation since the capsule network is capable of preserving the instantiated parameters of the categories trained by singlelabel documents .
The capsule network has much stronger transferring capability than the conventional deep neural networks .
In addition , the good results on Reuters - Full also indicate that the capsule network has robust superiority over competitors on single - label documents .
Connection Strength Visualization
To visualize the connection strength between capsule layers clearly , we remove the convolutional capsule layer and make the primary capsule layer followed by the fully connected capsule layer directly , where the primary capsules denote N-gram phrases in the form of capsules .
The connection strength shows the importance of each primary capsule for text categories , acting like a parallel attention mechanism .
This should allow the capsule networks to recognize multiple categories in the text even though the model is trained on singlelabel documents .
Due to space reasons , we choose a multilabel document from Reuters - Multi - label test set whose category labels ( i.e. , Interest Rates and Money / Foreign Exchange ) are correctly predicted ( fully correct ) by our model with high confidence ( p > 0.8 ) to report in .
The categoryspecific phrases such as " interest rates " and " foreign exchange " are highlighted with red color .
We use the tag cloud to visualize the 3 - gram phrases for Interest Rates and Money / Foreign Exchange categories .
The stronger the connection strength , the bigger the font size .
From the results , we observe that capsule networks can correctly recognize and cluster the important phrases with respect to the text categories .
The histograms are used to show the intensity of connection strengths between primary capsules and the fully connected capsules , as shown in To experimentally verify the convergence of the routing algorithm , we also plot learning curve to show the training loss overtime with different iterations of routing .
From , we observe that the Capsule - B with 3 or 5 iterations of routing optimizes the loss faster and converges to a lower loss at the end than the capsule network with 1 iteration .
U.K .
MONEY RATES FIRM ON LAWSON STERLING TARGETS
Interest Rates
Money / Foreign Exchange Interest rates on the London money market were slightly firmer on news U.K .
Chancellor of the Exchequer Nigel Lawson had stated target rates for sterling against the dollar and mark , dealers said .
They said this had come as a surprise and expected the targets , 2.90 marks and 1.60 dlrs , to be promptly tested in the foreign exchange markets .
Sterling opened 0.3 points lower in trade weighted terms at 71.3 .
Dealers noted the chancellor said he would achieve his goals on sterling by a combination of intervention in currency markets and interest rates .
Operators feel the foreign exchanges are likely to test sterling on the downside and that this seems to make a fall in U.K .
Base lending rates even less likely in the near term , dealers said .
The feeling remains in the market , however , that fundamental factors have not really changed and that arise in U.K .
Interest rates is not very likely .
The market is expected to continue at around these levels , reflecting the current 10 pct base rate level , for sometime .
The key three months interbank rate was 1 / 16 point firmer at 10 9 - 7 /8 pct .
Orphan
Mergers / Acquisitions Money / Foreign Exchange Trade Interest Rates
Related Work
Early methods for text classification adopted the typical features such as bag - of - words , n-grams , and their TF - IDF features as input of machine learning algorithms such as support vector machine ( SVM ) , naive Bayes ( NB ) for classification .
However , these models usually heavily relied on laborious feature engineering or massive extra linguistic resources .
Recent advances in deep neural networks and representation learning have substantially improved the performance of text classification tasks .
The dominant approaches are recurrent neural net -works , in particular LSTMs and CNNs. reported on a series of experiments with CNNs trained on top of pre-trained word vectors for sentence - level classification tasks .
The CNN models improved upon the state of the art on 4 out of 7 tasks .
offered an empirical exploration on the use of character - level convolutional networks ( Convnets ) for text classification and the experiments showed that Convnets outperformed the traditional models .
proposed a simple and efficient text classification method fastText , which could be trained on a billion words within ten minutes .
proposed a very deep convolutional networks ( with 29 convolutional layers ) for text classification .
generalized the LSTM to the tree - structured network topologies ( Tree - LSTM ) that achieved best results on two text classification tasks .
Recently , a novel type of neural network is proposed using the concept of capsules to improve the representational limitations of firstly introduced the concept of " capsules " to address the representational limitations of CNNs and RNNs .
Capsules with transformation matrices allowed networks to automatically learn part - whole relationships .
Consequently , proposed capsule networks that replaced the scalar - output feature detectors of CNNs with vector - output capsules and max - pooling with routing - by - agreement .
The capsule network has shown its potential by achieving a state - of - the - art result on MNIST data .
Unlike max - pooling in CNN , however , Capsule network do not throwaway information about the precise position of the entity within the region .
For lowlevel capsules , location information is placecoded by which capsule is active .
further tested out the application of capsule networks on CIFAR data with higher dimensionality .
proposed a new iterative routing procedure between capsule layers based on the EM algorithm , which achieves significantly better accuracy on the small NORB data set .
generalized existing routing methods within the framework of weighted kernel density estimation .
To date , no work investigates the performance of capsule networks in NLP tasks .
This study herein takes the lead in this topic .
Conclusion
In this paper , we investigated capsule networks with dynamic routing for text classification .
Three strategies were proposed to boost the performance of the dynamic routing process to alleviate the disturbance of noisy capsules .
Extensive experiments on six text classification benchmarks show the effectiveness of capsule networks in text classification .
More importantly , capsule networks also show significant improvement when transferring single - label to multi-label text classifications over strong baseline methods .
Supplementary Material
To better demonstrate the orphan and other categories with top unigrams , we remove the convolutional capsule layer and make the primary capsule layer followed by the fully connected capsule layer directly , similar to the settings in section 5.1 .
Here , the primary capsules denote uni-grams in the form of capsules .
We picked top - 20 uni-gram ( words ) from four categories ( i.e. , Orphan category , Trade category , Money Exchange category and Interest Rates category ) sorted by their connection strengths .
Money / Foreign Exchange Following is the text of a statement by the Group of Seven - the U.S. , Japan , West Germany , France , Britain , Italy and Canada - issued after a Washington meeting yesterday .
1 . The finance ministers and central bank governors of seven major industrial countries met today .
They continued the process of multilateral surveillance of their economies pursuant to the arrangements for strengthened economic policy coordination agreed at the 1986 Tokyo summit of their heads of state or government .
2 . The ministers and governors reaffirmed the commitment to the cooperative approach agreed at the recent Paris meeting , and noted the progress achieved in implementing the undertakings embodied in the Louvre Agreement .
In this connection they welcomed the proposals just announced by the governing Liberal Democratic Party in Japan for extraordinary and urgent measures to stimulate Japan 's economy through early implementation of a large supplementary budget exceeding those of previous years , as well as unprecedented front - end loading of public works expenditures .
They concluded that present and prospective progress in implementing the policy undertakings at the Louvre and in this statement provided a basis for continuing close cooperation to foster the stability of exchange rates .
Index
